<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>CN-DRGs国家DRGs质控中心-管理员</title>
    <script src="<%= static_path(@conn, "/css/jquery/jquery.min.js") %>"></script>
    <link rel="stylesheet" href="<%= static_path(@conn, "/css/semantic-ui/semantic.min.css") %>">
    <link rel="stylesheet" href="<%= static_path(@conn, "/css/calendar/calendar.css") %>">
    <script src="<%= static_path(@conn, "/css/semantic-ui/semantic.min.js") %>"></script>
    <script src="<%= static_path(@conn, "/css/calendar/calendar.min.js") %>"></script>
    <script src="<%= static_path(@conn, "/css/vue.min.js") %>"></script>
  </head>

  <body>
    <div class="ui text menu" style="margin-top:6px;border-bottom:1px solid #d4d4d5;box-shadow:3px 2px 3px #dedede;"  id="app_menu">
      <a class="item" href="/admin/"><h1 class="ui header">&nbsp;&nbsp;CN-DRGs网站管理系统</h1></a>
    </div>
    <div class="container" id="index_1">
      <div class="ui grid" style="margin-top:200px;">
        <div class="six wide column">
        </div>
        <div class="four wide column">
          <h2 class="ui center aligned header"> 登录管理端</h2>
          <form class="ui form">
            <div class="ui segment">
              <div class="field">
                <div class="ui left icon input">
                  <input type="username" id="username" placeholder="账号" v-model="username">
                  <i class="user icon"></i>
                </div>
                <div style="display:none;" id="name_tishi1"><div class="ui basic red pointing prompt label transition visible" id="name_tishi2"></div></div>
              </div>
              <div class="field">
                <div class="ui left icon input">
                  <input type="password" id="password" placeholder="密码" v-model="password" @keyup.13="login()">
                  <i class="lock icon"></i>
                </div>
                <div style="display:none;" id="tishi1"><div class="ui basic red pointing prompt label transition visible" id="tishi2"></div></div>
              </div>
              <div class="ui fluid primary submit button" v-on:click="login()"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录</font></font></div>
              <!-- <div class="ui blue submit button" onclick="login()">登录</div> -->
            </div>
          </form>
        </div>
        <div class="six wide column">
        </div>
      </div>
    </div>
  </body>
</html>
<script>
$(document).ready(function() {
  Vue.prototype.$ajax = $.ajax;
  common = new Vue({
    el: '#index_1',
    data: {
      username: '',
      password: '',
      usernameLength: 0,
      passwordLength: 0
    },
    created: function () {
      // this.department_list()
    },
    methods: {
      login: function () {
        this.usernameLength = this.username.length
        this.passwordLength = this.password.length
        if(this.usernameLength === 0){
          $("#name_tishi2").text("请输入用户名");
          $("#name_tishi1").show();
        }else{
          $('#name_tishi1').css('display','none');
        }
        //密码
        if(this.passwordLength === 0){
          $("#tishi2").text("请输入密码");
          $("#tishi1").show();
        }else{
          $('#tishi1').css('display','none');
        }
        if (this.usernameLength !== 0 || this.passwordLength !== 0) {
          $.ajax({
            type: "POST",
            url: '/api/login/',
            data: {user: {username:this.username, password:this.password}},
            async: false,
            success: function(data) {
              if(data.login){
                window.location.href = "/admin/"
              }else{
                $("#tishi2").text("用户名密码错误");
                $("#tishi1").show();
              }
            },
            dataType: 'json'
          });
        }
      }
    }
  })
})
</script>
</script>
